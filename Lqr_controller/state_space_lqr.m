kt = 1.69e-2;
kf = 6.41e-6;
gamma = 2.75e-3;
rho = 1;
m=0.5;
g= 9.8;
l = 0.17;
IxxT = 3.2e-3;
IzzT = 5.5e-3;
IzzP = 1.5e-5;
IxxB = IxxT;
m1 = l/IxxB;
m2 = kf*l/IxxB;

bar = struct('f1',1.84018353576,'f3',1.8401835357630309992325289298678,'f2',1.6193615114714672793246254582836,'rho',0.8800,'r',12.665815987244600273990293667104,'q',5.2193209522172301842820730786108,'epsilon',0.072997716928397925310620583217414,'nz',0.92457565010405823825824215457727,'ny',0.38099851342840968286757960499511,'w1',535.7986,'w3',535.7986,'w2',502.6236,'w4',0,'p',0,'nx',0);
a = ((IxxT - IzzT)*bar.r/IxxB)-(IzzP/IxxB)*(bar.w1 + bar.w2 + bar.w3 + bar.w4);
A = [0 a 0 0; -a 0 0 0; 0 -bar.nz 0 bar.r; bar.nz 0 -bar.r 0]

B = (l/IxxB)*[0 1; 1 0; 0 0; 0 0;]

Q = [1 0 0 0; 0 1 0 0; 0 0 20 0; 0 0 0 20]

R = 1

K = lqr(A,B,Q,R)

eig(A-B*K)
tspan = 0:0.01:5;
s0 = [2.1; 3.7; 0.14; 0.26]
%s0 = [9; 5.6; 0.8; 0.7]

[t_out,x_out] = ode45(@(t,s)evalode(t,s,m1,m2,bar,a,K), tspan, s0);
